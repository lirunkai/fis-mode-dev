#!/usr/bin/env node

const program = require('commander');
const fs = require('fs');
const path = require('path');
const shelljs = require('shelljs');

let config = JSON.parse(fs.readFileSync(path.resolve(__dirname, '../config.json'), {encoding: "utf8"}));

let fisContent = `
fis.match("*", {

})
`


program
.version('1.0.0')
.option('-h', 'link  get your registore path  do so path')

// 同步
program
.command('sync')
.action(function(){
  let devPath = process.cwd()
  console.log(config.libraryPath +'=>'+ devPath)
  if(config.libraryPath != null){
    shelljs.cd(config.libraryPath)
    shelljs.exec(`fis3 release -wd ${devPath}`)
  }
})

// 获取仓库地址
program
.command('link')
.action(function(){

  config.libraryPath = process.cwd()
  let configPath = path.resolve(__dirname, "../config.json")
  fs.writeFileSync(configPath, JSON.stringify(config));
  let fisFilePath = path.resolve(config.libraryPath, 'fis-conf.js')
  fs.writeFileSync(fisFilePath, fisContent, {encoding: 'utf-8'})
  console.log(config.libraryPath)
  process.exit(0);

});

// 关闭 没验证是否执行
program
.command('close')
.action(() => {
  process.exit(0);
})


program.on('--help', () => {
  console.log(
    `
      mvtool sync  同步仓库代码
      mvtool link  获取仓库路径
    `
  )
})

program.parse(process.argv);
